(function(c){c.fn.mrs2000box=function(a,D){function R(){k=c(".m2b-shadow");0==k.length?(k=c('<div class="m2b-shadow"></div>'),k.appendTo("body").click(u),d=c('<div class="m2b-frame"><div class="m2b-shadow2"></div><div class="m2b-spinner"><div class="m2b-double-bounce1"></div><div class="m2b-double-bounce2"></div></div><img class="m2b-image"><div class="m2b-error"></div><div class="m2b-left"></div><div class="m2b-right"></div><div class="m2b-btn-close"></div><div class="m2b-title"></div></div>'),d.appendTo("body")):
(d=c(".m2b-frame"),d.show(),k.show());v=d.find(".m2b-spinner");g=d.find(".m2b-image");g.hide().on("load",S).click(E);d.click(E);q=d.find(".m2b-left");r=d.find(".m2b-right");q.click(F);r.click(G);l=d.find(".m2b-title");(a.showTitle||a.showNumber)&&l.show();w=d.find(".m2b-error");w.hide();y=d.find(".m2b-btn-close");y.click(u);h=new Image;h.onload=function(){t?(m=h.naturalWidth,n=h.naturalHeight,g.attr("src",h.src).show(),H()):t=!0};h.onerror=function(){t&&(w.show(),g.hide(),v.hide(),H())};c(window).bind("resize",
I);c(document).bind("keyup",J)}function I(){if(x&&(K(),a.onResize))a.onResize({width:m,height:n,object:e[f].object,img:g})}function J(b){if(x)switch(b.which){case 27:u();break;case 37:F();break;case 39:G()}}function K(){var b=d.width(),a=d.height(),e=m/n;L&&(a-=l.outerHeight());if(e>b/a){var c=m>b?b:m;var f=c/e}else f=n>a?a:n,c=f*e;g.css({top:.5*a-.5*f,left:.5*b-.5*c,width:c,height:f})}function S(){""!=l.html()&&(L=!0,l.show());if(a.onLoad)a.onLoad({width:m,height:n,object:e[f].object,img:this});
K();v.hide()}function E(){(2>e.length||!a.showGallery)&&u()}function z(){if(a.onBeforeLoad)a.onBeforeLoad({img:g});(a.showTitle||a.showNumber)&&l.html(e[f].title).hide();g.hide();v.show();w.hide();t=!0;A=f;h.src=e[f].href}function H(){1<e.length&&(t=!1,A=1==B?M():N(),h.src=e[A].href)}function N(){var b=f-1;-1==b&&(b=e.length-1);return b}function M(){var b=f+1;b==e.length&&(b=0);return b}function F(){1<e.length&&a.showGallery&&(B=0,f=N(),z())}function G(){1<e.length&&a.showGallery&&(B=1,f=M(),z())}
function O(b){var c="";a.showNumber&&b.rel&&(c+="<b>\u0424\u043e\u0442\u043e \u2116"+b.rel+"</b> ");return c+b.title}function P(b){if("A"==b.tagName){b=c(b).parent();if(b.data("m2b"))return;b.data("m2b-wrapper",!0)}else b=c(b);b.data("m2b",!0);return b}function Q(b,c){R();e=[];if(a.showGallery){var d=b.find("a"),g="href";0==d.length&&(g="src",d=b.find("img"));d.each(function(b,a){a==c&&(f=b);e.push({object:a,href:a[g],title:O(a)})})}else e.push({object:c,href:c.href,title:O(c)});1<e.length&&a.showGallery?
(q.show(),r.show()):(q.hide(),r.hide());z();x=!0}function u(){k.hide();d.hide();q.unbind("click");r.unbind("click");y.unbind("click");g.unbind("load");g.unbind("click");d.unbind("click");c(window).unbind("resize",I);c(document).unbind("keyup",J);x=!1;if(a.onClose)a.onClose()}var v=null,k=null,g=null,d=null,q=null,r=null,y=null,l=null,w=null,e=[],f=0,h=null,B=1,m,n,L,x=!1,t=!0,A;if(c.isPlainObject(a))return a=c.extend({showTitle:!0,showNumber:!0,showGallery:!1,advanced:!1,onBeforeLoad:null,onLoad:null,
onResize:null,onClose:null,eventSelector:"a"},a),a.advanced&&(a.showGallery=!0,a.showTitle=!0,a.showNumber=!0),c(this).each(function(){var b=P(this);b&&(b.data("m2b-options",a),b.on("click",a.eventSelector,function(a){a.preventDefault();a.stopPropagation();Q(b,this)}))});var p=P(this);if(p&&"show"===a){var C="undefined"===typeof D?0:D;var T=p.data("m2b-wrapper")?p.find("a").eq(C):p.eq(C);a=p.data("m2b-options");f=C;Q(p,T[0])}}})(jQuery);